# Internationalization (i18n) Documentation

## Overview

This document describes the multi-locale, multi-market implementation strategy for the Ibexa Experience project. Full implementation will occur in **Section 4** of the assessment.

## Siteaccess Configuration

### Planned Siteaccesses

| Siteaccess | Market | Language | Code | URL Prefix |
|------------|--------|----------|------|------------|
| global-en | Global | English | eng-GB | /global-en |
| my-en | Malaysia | English | eng-MY | /my-en |
| th-en | Thailand | English | eng-TH | /th-en |
| th-th | Thailand | Thai | tha-TH | /th-th |

### Siteaccess Matching

URL-based matching with first segment:

```
https://example.com/global-en/home  ‚Üí global-en siteaccess
https://example.com/my-en/home      ‚Üí my-en siteaccess
https://example.com/th-en/home      ‚Üí th-en siteaccess
https://example.com/th-th/home      ‚Üí th-th siteaccess
```

### Configuration Structure

```yaml
# config/packages/ibexa.yaml
ibexa:
    siteaccess:
        default_siteaccess: global-en
        list:
            - global-en
            - my-en
            - th-en
            - th-th
            - admin
        groups:
            site_group:
                - global-en
                - my-en
                - th-en
                - th-th
            frontend_group:
                - global-en
                - my-en
                - th-en
                - th-th
            admin_group:
                - admin
        match:
            Compound\URIElement:
                global-en:
                    matchers:
                        URIElement: 1
                    match: global-en
                my-en:
                    matchers:
                        URIElement: 1
                    match: my-en
                th-en:
                    matchers:
                        URIElement: 1
                    match: th-en
                th-th:
                    matchers:
                        URIElement: 1
                    match: th-th
```

## Language Configuration

### Language Definitions

```yaml
# config/packages/ibexa.yaml
ibexa:
    system:
        # Global settings
        default:
            languages:
                - eng-GB
        
        # Global English
        global-en:
            languages:
                - eng-GB
        
        # Malaysia English
        my-en:
            languages:
                - eng-MY
                - eng-GB  # Fallback
        
        # Thailand English
        th-en:
            languages:
                - eng-TH
                - eng-GB  # Fallback
        
        # Thailand Thai
        th-th:
            languages:
                - tha-TH
                - eng-TH  # Fallback to Thai English
                - eng-GB  # Ultimate fallback
        
        # Admin always in English
        admin:
            languages:
                - eng-GB
```

### Language Fallback Chain

**Malaysia English (my-en)**:
```
eng-MY ‚Üí eng-GB
```

**Thailand English (th-en)**:
```
eng-TH ‚Üí eng-GB
```

**Thailand Thai (th-th)**:
```
tha-TH ‚Üí eng-TH ‚Üí eng-GB
```

**Rationale**:
- Regional English variants may have local terminology
- Falls back to global English if not localized
- Thai language falls back through Thai English before global English

## Content Translation

### Translation Strategy

**Base Content**:
- Created in primary language (typically eng-GB)
- Stored at location in content tree
- Versioned per language

**Translations**:
- Each language stored as separate version
- Editors create translations via admin UI
- Incomplete translations use fallback

### Translation Status Indicators

In the admin UI, editors will see:
- ‚úÖ **Fully Translated**: All fields translated
- ‚ö†Ô∏è **Partially Translated**: Some fields using fallback
- ‚ùå **Not Translated**: Using fallback entirely

### Field-Level Translation

**Translatable Fields**:
- Title
- Body/Rich Text
- Summary/Description
- Meta titles and descriptions
- Image alt text
- Button labels

**Non-Translatable Fields**:
- Internal identifiers
- URLs (external references)
- Dates
- Numbers/codes
- Boolean flags

## URL Structure with Locales

### URL Format

```
/{siteaccess}/{path-to-content}
```

### Examples

**Home Page**:
```
/global-en/home   # Global English
/my-en/home       # Malaysia English
/th-en/home       # Thailand English
/th-th/home       # Thailand Thai
```

**Deep Page**:
```
/global-en/home/business-units/performance-materials
/my-en/home/business-units/performance-materials
/th-en/home/business-units/performance-materials
/th-th/home/business-units/performance-materials
```

**With Localized Slugs** (future enhancement):
```
/th-th/home/‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à/‡∏ß‡∏±‡∏™‡∏î‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û
```

## Language Switcher

### Implementation

**Template**:
```twig
{# templates/components/language_switcher.html.twig #}
<nav class="language-switcher">
    <ul>
        {% for siteaccess in available_siteaccesses %}
            {% set translation = get_translation(content, siteaccess.language) %}
            {% if translation %}
                <li>
                    <a href="{{ ibexa_path(translation, {}, siteaccess.name) }}"
                       hreflang="{{ siteaccess.language_code }}"
                       {% if siteaccess.name == current_siteaccess %}aria-current="true"{% endif %}>
                        {{ siteaccess.label }}
                    </a>
                </li>
            {% endif %}
        {% endfor %}
    </ul>
</nav>
```

**Service**:
```php
interface LanguageSwitcherInterface
{
    /**
     * Get available siteaccesses for content
     */
    public function getAvailableSiteaccesses(Content $content): array;
    
    /**
     * Get translation in specific language
     */
    public function getTranslation(Content $content, string $languageCode): ?Content;
    
    /**
     * Check if content is translated in language
     */
    public function hasTranslation(Content $content, string $languageCode): bool;
}
```

### Behavior

1. **Translation Exists**: Link to translated version at same location
2. **No Translation**: Either hide link OR link to fallback with indicator
3. **Current Language**: Highlighted/disabled
4. **SEO**: Proper hreflang attributes

## Editorial Workflow

### Creating Localized Content

**Step 1: Create Base Content**
```
1. Editor logs into admin
2. Selects primary language (eng-GB)
3. Creates content with all fields
4. Publishes
```

**Step 2: Add Translation**
```
1. Editor opens published content
2. Clicks "Translate" button
3. Selects target language (e.g., tha-TH)
4. Admin UI shows side-by-side view:
   - Left: Source language (read-only)
   - Right: Target language (editable)
5. Editor translates fields
6. Saves draft or publishes
```

**Step 3: Update Translation**
```
1. If source content changes, translation shows "Outdated" indicator
2. Editor can compare versions
3. Updates translation accordingly
```

### Language-Specific Editors

**Permissions**:
- Global editors: All languages
- Regional editors: Specific languages only
- Translators: Translation interface access

**Configuration**:
```yaml
# config/packages/security.yaml
ibexa:
    system:
        my-en:
            user:
                language_limitations:
                    - eng-MY
        th-th:
            user:
                language_limitations:
                    - tha-TH
                    - eng-TH
```

## Page Builder Localization

### Locale-Specific Sections

**Scenario**: Same page layout, different content per locale

**Implementation**:
- Page layout shared across languages
- Block content localizable per language
- Blocks can be locale-specific or shared

### Block Localization Modes

#### 1. Fully Localized Block
**All** fields translated per language:
```yaml
# Hero block in eng-GB
headline: "Welcome to Our Site"
subheadline: "Discover innovation"
cta_text: "Learn More"

# Hero block in tha-TH
headline: "‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏™‡∏π‡πà‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤"
subheadline: "‡∏Ñ‡πâ‡∏ô‡∏û‡∏ö‡∏ô‡∏ß‡∏±‡∏ï‡∏Å‡∏£‡∏£‡∏°"
cta_text: "‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°"
```

#### 2. Partially Localized Block
**Some** fields translated, others shared:
```yaml
# Content listing block
title: "Latest News"           # Localized
content_type: "news_article"   # Shared
limit: 5                        # Shared
layout: "grid"                  # Shared
```

#### 3. Shared Block
**No** translation, same across languages:
```yaml
# Video embed block
video_url: "https://youtube.com/..."  # Shared
autoplay: false                       # Shared
```

### Configuration

```yaml
# config/packages/ibexa_page_builder.yaml
ibexa_page_builder:
    blocks:
        hero:
            name: Hero Block
            views:
                default:
                    name: Default
            attributes:
                headline:
                    type: text
                    name: Headline
                    translatable: true      # ‚Üê Localizable
                subheadline:
                    type: text
                    name: Subheadline
                    translatable: true
                background_image:
                    type: image
                    name: Background
                    translatable: false     # ‚Üê Shared
```

### Editorial Experience

**In Page Builder**:
1. Editor switches language in admin UI
2. Localizable blocks show "Translate" option
3. Side-by-side view: source vs. target
4. Shared blocks show "Same for all languages" indicator
5. Preview per language

**Clear Indicators**:
- üåê Localizable field (empty/needs translation)
- ‚úÖ Translated field
- üîí Shared field (non-localizable)

## Fallback Behavior

### Content Fallback

**Scenario**: Content not translated in requested language

**Behavior**:
```
User visits: /th-th/home/insights/article-1

1. Check for tha-TH translation ‚Üí Not found
2. Check eng-TH translation ‚Üí Not found
3. Use eng-GB translation ‚Üí Found ‚úì
4. Display eng-GB content
5. Show language notice: "This content is not available in Thai"
```

### Field Fallback

**Scenario**: Some fields translated, others not

**Behavior**:
```
Content in tha-TH:
- title: "‡∏ö‡∏ó‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏´‡∏°‡πà" (translated)
- body: "" (not translated ‚Üí falls back to eng-GB)
- image: [shared across all languages]

Display:
- Title in Thai
- Body in English with subtle indicator
- Image shown (no indicator needed)
```

### Page Builder Fallback

**Scenario**: Block not localized

**Behavior**:
```
Page in th-th:
- Block 1 (Hero): Localized to tha-TH ‚úì
- Block 2 (RichText): Not localized ‚Üí uses eng-GB
- Block 3 (Listing): Shared (shows Thai content if available)
```

## Locale-Specific Configuration

### Dates and Times

```yaml
# config/packages/ibexa.yaml
ibexa:
    system:
        global-en:
            date_format:
                short: 'd/m/Y'
                medium: 'd M Y'
                full: 'd F Y'
            time_format: 'H:i'
            timezone: 'UTC'
        
        my-en:
            date_format:
                short: 'd/m/Y'
            timezone: 'Asia/Kuala_Lumpur'
        
        th-th:
            date_format:
                short: 'd/m/Y'  # Or Buddhist calendar
            timezone: 'Asia/Bangkok'
```

### Number Formats

```yaml
ibexa:
    system:
        global-en:
            number_format:
                decimal_separator: '.'
                thousands_separator: ','
        
        th-th:
            number_format:
                decimal_separator: '.'
                thousands_separator: ','
```

### Currency (Future)

```yaml
ibexa:
    system:
        my-en:
            currency: 'MYR'
            currency_symbol: 'RM'
        
        th-th:
            currency: 'THB'
            currency_symbol: '‡∏ø'
```

## SEO for Multi-Language

### Hreflang Implementation

```twig
{# templates/layouts/base.html.twig #}
<head>
    {# Current page canonical #}
    <link rel="canonical" href="{{ ibexa_url(content) }}" />
    
    {# All language alternatives #}
    {% for siteaccess, translation in get_all_translations(content) %}
        <link rel="alternate" 
              hreflang="{{ siteaccess.language_code }}" 
              href="{{ ibexa_url(translation, {}, siteaccess.name) }}" />
    {% endfor %}
    
    {# Default language #}
    <link rel="alternate" 
          hreflang="x-default" 
          href="{{ ibexa_url(content, {}, 'global-en') }}" />
</head>
```

### Example Output

```html
<link rel="canonical" href="https://example.com/global-en/home" />
<link rel="alternate" hreflang="en-GB" href="https://example.com/global-en/home" />
<link rel="alternate" hreflang="en-MY" href="https://example.com/my-en/home" />
<link rel="alternate" hreflang="en-TH" href="https://example.com/th-en/home" />
<link rel="alternate" hreflang="th-TH" href="https://example.com/th-th/home" />
<link rel="alternate" hreflang="x-default" href="https://example.com/global-en/home" />
```

### Sitemap Generation

Per-language sitemaps:
```
/sitemap-global-en.xml
/sitemap-my-en.xml
/sitemap-th-en.xml
/sitemap-th-th.xml
/sitemap-index.xml  (references all)
```

## Testing Strategy

### Functional Tests

```php
class MultiLocaleTest extends WebTestCase
{
    public function testAllLocalesAccessible(): void
    {
        $locales = ['global-en', 'my-en', 'th-en', 'th-th'];
        
        foreach ($locales as $locale) {
            $client = static::createClient();
            $client->request('GET', "/{$locale}/home");
            
            $this->assertResponseIsSuccessful();
        }
    }
    
    public function testLanguageFallback(): void
    {
        // Create content only in eng-GB
        // Access via th-th
        // Verify eng-GB content shown
    }
    
    public function testLanguageSwitcherKeepsLocation(): void
    {
        // Visit /global-en/home/about-us
        // Click on th-th switcher
        // Should land on /th-th/home/about-us
    }
}
```

## Implementation Checklist (Section 4)

- [ ] Configure all 4 siteaccesses in `ibexa.yaml`
- [ ] Set up language definitions (eng-GB, eng-MY, eng-TH, tha-TH)
- [ ] Configure language fallback chains
- [ ] Update routing to include siteaccess prefix
- [ ] Implement language switcher component
- [ ] Create translation workflow documentation
- [ ] Configure Page Builder block translatability
- [ ] Implement fallback indicators in frontend
- [ ] Add hreflang tags to templates
- [ ] Create per-locale sitemaps
- [ ] Test all siteaccess URLs
- [ ] Test language fallback behavior
- [ ] Test language switcher navigation
- [ ] Create editorial guide for translations
- [ ] Add screenshots of translation UI
- [ ] Test Page Builder locale-specific sections

## Editorial Guidelines

### Translation Checklist

**For Editors**:
1. ‚úÖ Translate all required fields
2. ‚úÖ Review character limits (may differ per language)
3. ‚úÖ Localize dates and numbers
4. ‚úÖ Test links (ensure they point to localized targets)
5. ‚úÖ Preview in target locale
6. ‚úÖ Check SEO metadata
7. ‚úÖ Verify images have localized alt text

### Quality Assurance

**Pre-Publication**:
- All required fields translated
- No fallback warnings on key content
- Language switcher functional
- URLs correct per locale
- SEO tags complete

## Performance Considerations

### Caching Strategy
- Cache per siteaccess
- Cache per language
- Shared cache for non-localized content

### Database Queries
- Eager load translations
- Index on language_code
- Optimize fallback queries

## References

- Ibexa Multilanguage: https://doc.ibexa.co/en/latest/guide/internationalization/
- Ibexa SiteAccess: https://doc.ibexa.co/en/latest/guide/siteaccess/
- Hreflang Best Practices: https://developers.google.com/search/docs/advanced/crawling/localized-versions

---

**Note**: This document outlines the planned i18n implementation. Full implementation will occur in Section 4 of the assessment.
